
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>mLeaderboard_table</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/2.2.0/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }

      @media (max-width: 980px) {
        /* Enable use of floated navbar text */
        .navbar-text.pull-right {
          float: none;
          padding-left: 5px;
          padding-right: 5px;
        }
      }
    </style>
    <script src="./js/operData.js"></script>
    <script type="text/javascript">
    // get the json url from restful api url: 
    // https://mobile-ci.twitter.biz/view/Android%20Automation%20Dash/job/twitter-android-ui-tests/api/json?pretty=true
    // now just demo from local: restapi.json
    // pass the para "build" to loadJSONDoc(build)
    function getLatestBuild() {
        // Get latest build implementation here
        var jobInfoUrl = "json/android/restapi.json";
        var xhr;
        if (window.XMLHttpRequest) {
          xhr = new XMLHttpRequest();
        }
        else {
          xhr = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            var jobInfo = JSON.parse(xhr.responseText);
            var latestBuild = jobInfo.builds[0].url;
            loadJSONDoc(latestBuild);
          }
        };
        xhr.open("GET", jobInfoUrl, true);
        xhr.send(null);
    }

    // function loadJSONDoc(build) {
    function loadJSONDoc() {
      var xmlhttp;
      if (window.XMLHttpRequest) {
      // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp=new XMLHttpRequest();
      }
      else {
      // code for IE6, IE5
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
      }
      xmlhttp.onreadystatechange=function() {
        if (xmlhttp.readyState==4 && xmlhttp.status==200) {
            var txt = xmlhttp.responseText;
            var obj = JSON.parse(txt);
            populate(obj);
          }
        }
        // var url = build + "artifact/scripts/mobile-test-reporting/artifacts/testsuites.json";
        // var url = "https://mobile-ci.twitter.biz/view/Android/job/twitter-android-ui-tests/2081/artifact/scripts/mobile-test-reporting/artifacts/testsuites.json";
        var url = "json/android/testsuites.json";
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
      }
          
      function populate(testResults) {
        var arr = new Array();
        arr = populateResults(testResults);
        arr = sort(arr, "testCaseCount");
        // render the table
        var str = "<table class='table table-hover'><tr><th>rank</th><th>contributor</th><th>test case#</th><th>test suite#</th><th>more details</th></tr>";
        for(var j=0; j<arr.length; j++) {
          str = str + "<tr>";
          str = str + ("<td>" + j + "</td>");
          // show the person's profile
          var userName = "https://birdhouse.twitter.biz/people/profile/" + arr[j].contr;
          String(userName);
          str = str + ("<td><a href='"+userName.replace("@twitter.com", "/")+"'>" + arr[j].contr + "</a></td>");
          // show the test case count
          str = str + ("<td>" + arr[j].testCaseCount + "</td>");
          // show the test suite count
          str = str + ("<td>" + arr[j].testSuiteCount + "</td>");
          str = str + ("<td><a href='boardTree.html#"+ arr[j].contr +"'>" + "##" + "</a></td>");
          str = str + ("</tr>");
        }
        str = str + ("</table>");
        document.getElementById("ajaxRefresh").innerHTML = str;
      }

      // show tree on load
      addEventListener("load", function () {
        loadJSONDoc();
      });
      </script>

  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="./boardChart.html">mLeaderboard</a>
          <div class="nav-collapse collapse">
            <p class="navbar-text pull-right">
              Logged in as <a href="#" class="navbar-link">Username</a>
            </p>
            <ul class="nav">
              <li><a href="./boardChart.html">Chart</a></li>
              <li class="active"><a href="./boardTable.html">Table</a></li>
              <li><a href="./boardTree.html">Tree</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span9">
          <button type="button" class="btn btn-default" onclick="loadJSONDoc()">show</button>
          <button type="button" class="btn btn-default" onclick="getLatestBuild()">test</button>
          <div id="ajaxRefresh" class="bs-example"></div>
        </div>
      </div><!--/row-->
      <hr>
      <footer>
        <p>&copy; Twitter 2014</p>
      </footer>
    </div><!--/.fluid-container-->

  </body>
</html>
