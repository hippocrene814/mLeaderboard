<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>mLeaderboard_chart</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/2.2.0/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }

      @media (max-width: 980px) {
        /* Enable use of floated navbar text */
        .navbar-text.pull-right {
          float: none;
          padding-left: 5px;
          padding-right: 5px;
        }
      }
    </style>
    <script src="./js/Chart.js"></script>
    <script type="text/javascript">
    // function loadJSONDoc(build) {
    function loadJSONDoc(indx) {
      var xmlhttp=new XMLHttpRequest();
      xmlhttp.onload=function() {
        var txt = xmlhttp.responseText;
        var obj = JSON.parse(txt);
        populateResults(obj,indx);
      }
        // var url = build + "artifact/scripts/mobile-test-reporting/artifacts/testsuites.json";
      var url = "testsuites.json";
      xmlhttp.open("GET", url, true);
      xmlhttp.send();
    }

    function populateResults(testResults,indx) {
      //create an array to save each contributor with his/her
      //testCase and testSuite
      //arr[i].contr, arr[i].testCases, arr[i].testSuites
      var arr = new Array();
      for(var testSuite in testResults) {
        var testSuiteData = testResults[testSuite];
        for(var testCase in testSuiteData["test_cases"]) {
          testCaseFull = testSuite + '.' + testCase; // the whole name of test case
          var testCaseData = testSuiteData["test_cases"][testCase];
          for(var i=0; i<testCaseData["contributors"].length; i++) {
            var testCaseContr = testCaseData["contributors"][i];
            var flag = 0;
            for(var j=0; j<arr.length; j++) {
              if(arr[j].contr == testCaseContr) {
                flag = 1;
                arr[j].testCases.push(testCaseFull);
                if((arr[j].testSuites)[arr[j].testSuites.length-1] != testSuite) {
                  arr[j].testSuites.push(testSuite);
                }
                break;
              }
            }
            if(flag == 0) {
              var obj = new Object();
              obj.contr = testCaseContr;
              var newTestCases = [testCaseFull];
              obj.testCases = newTestCases;
              var newTestSuites = [testSuite];
              obj.testSuites = newTestSuites;
              arr.push(obj);
            }
          } // contributor, i
        } // testCase
      } // testSuite

      // count the number of each contributor
      for(var j=0; j<arr.length; j++) {
        arr[j].testCaseCount = (arr[j].testCases).length;
        arr[j].testSuiteCount = (arr[j].testSuites).length;
      }

      var lineChartData = {
        labels : [],
        datasets : [
          {
            label: "My First dataset",
            fillColor : "rgba(220,220,220,0.2)",
            strokeColor : "rgba(220,220,220,1)",
            pointColor : "rgba(220,220,220,1)",
            pointStrokeColor : "#fff",
            pointHighlightFill : "#fff",
            pointHighlightStroke : "rgba(220,220,220,1)",
            data : []
          },
          {
            label: "My Second dataset",
            fillColor : "rgba(151,187,205,0.2)",
            strokeColor : "rgba(151,187,205,1)",
            pointColor : "rgba(151,187,205,1)",
            pointStrokeColor : "#fff",
            pointHighlightFill : "#fff",
            pointHighlightStroke : "rgba(151,187,205,1)",
            data : []
          }
        ]
      }

      if(indx == 100) {
        for(var j=0; j<20; j++) {
          lineChartData.labels.push(arr[j].contr);
          (lineChartData.datasets)[0].data.push(arr[j].testCaseCount);
          (lineChartData.datasets)[1].data.push(arr[j].testSuiteCount);
        }
      }
      else {
        arr.sort(compare("testCaseCount"));
        for(var j=indx; j<(20+indx); j++) {
          lineChartData.labels.push(arr[j].contr);
          (lineChartData.datasets)[0].data.push(arr[j].testCaseCount);
          (lineChartData.datasets)[1].data.push(arr[j].testSuiteCount);
        }
      }

      document.getElementById("canvas_holder").innerHTML = '<canvas id="canvas" height="1000" width="2000"></canvas>';
      var ctx = document.getElementById("canvas").getContext("2d");
      new Chart(ctx).Bar(lineChartData, {
          responsive: true
      });
    }

    // create a comparator to sort the arr[] by test case count
    function compare(propertyName) {
      return function (object1, object2) {
        var value1 = object1[propertyName];
        var value2 = object2[propertyName];
        if (value2 < value1) {
          return -1;
        }
        else if (value2 > value1) {
          return 1;
        }
        else {
          return 0;
        }
      }
    }
    addEventListener("load", function () {
      loadJSONDoc(0);
    });
    </script>
  </head>
  
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="#">mLeaderboard</a>
          <div class="nav-collapse collapse">
            <p class="navbar-text pull-right">
              Logged in as <a href="#" class="navbar-link">Username</a>
            </p>
            <ul class="nav">
              <li><a href="./boardHome.html">Home</a></li>
              <li><a href="./boardTable.html">Table</a></li>
              <li class="active"><a href="./boardChart.html">Chart</a></li>
              <li><a href="./boardTree.html">Tree</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
    <button type="button" class="btn btn-default" onclick="loadJSONDoc(100)">random</button>
    <button type="button" class="btn btn-default" onclick="loadJSONDoc(0)">1~20</button>
    <button type="button" class="btn btn-default" onclick="loadJSONDoc(20)">21~40</button>
    <button type="button" class="btn btn-default" onclick="loadJSONDoc(40)">41~60</button>
    <div id="canvas_holder" style="width:80%">
        <!--<canvas id="canvas" height="1000" width="2000"></canvas>-->
    </div>
  </body>
</html>
